# Dockerfile for running Playwright tests in an environment that mirrors GitHub Actions
# Based on Ubuntu 24.04 (noble) - same as GitHub Actions ubuntu-latest

FROM mcr.microsoft.com/playwright:v1.57.0-noble

# Install Hugo
ARG HUGO_VERSION=0.147.1
RUN wget -q https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.deb && \
    dpkg -i hugo_extended_${HUGO_VERSION}_linux-amd64.deb && \
    rm hugo_extended_${HUGO_VERSION}_linux-amd64.deb

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install Node.js dependencies
RUN npm ci

# Install all Playwright browsers (chromium, firefox, webkit, chrome)
RUN npx playwright install --with-deps chromium firefox webkit chrome

# Copy the rest of the application
COPY . .

# Build the site
RUN npm run build

# Set environment variables
ENV CI=true
ENV TEST_ENV=ci
ENV HUGO_ENV=test

# Default command runs all tests
CMD ["npx", "playwright", "test"]
