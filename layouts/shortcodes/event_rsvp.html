{{ $attendance_cap := .Get "attendance_cap" | default "15" }}

{{- /* Use the page's URL path to generate a consistent event ID */ -}}
{{- $event_id := .Page.RelPermalink | strings.TrimPrefix "/events/" | strings.TrimSuffix "/" -}}

{{- /* Add event start time metadata if available */ -}}
{{ if .Page.Params.start_time }}
<meta name="event-start-time" content="{{ .Page.Params.start_time }}">
{{ end }}

<div class="event-rsvp-widget mt-8 p-4 rounded bg-white" data-event-id="{{ $event_id }}" data-attendance-cap="{{ $attendance_cap }}">
  <div class="mb-4">
    <h3 class="text-xl font-bold text-eden-green mb-1">Event Registration</h3>
    <p class="text-gray-600">
      <span class="rsvp-count">0</span>/<span class="rsvp-capacity">{{ $attendance_cap }}</span> registered
      &bull; <span class="rsvp-status">Checking availability...</span>
    </p>
  </div>
  
  <button type="button" class="rsvp-toggle-button bg-eden-green hover:bg-green-700 text-white py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full md:w-auto">
    Sign Up
  </button>

  <div class="rsvp-success hidden mt-4 p-3 bg-green-100 text-green-700 border border-green-200 rounded">
    Thank you for registering! We look forward to seeing you at the event.
  </div>

  <div class="rsvp-error hidden mt-4 p-3 bg-red-100 text-red-700 border border-red-200 rounded">
  </div>
</div>

<script src="/js/auth-client.js"></script>
<script src="/js/event-rsvp.js"></script>

<!-- Debug and initialize auth client -->
<script>
console.log('=== Auth Client Debug ===');
console.log('AuthClient class available:', typeof AuthClient);
console.log('window.authClient exists:', !!window.authClient);

// Simple initialization without complex retry logic
if (typeof AuthClient !== 'undefined') {
  try {
    if (!window.authClient) {
      window.authClient = new AuthClient();
      console.log('✅ Auth client created successfully');
    }
    console.log('Auth client methods:', Object.getOwnPropertyNames(Object.getPrototypeOf(window.authClient)));
    console.log('cancelEventRsvp method type:', typeof window.authClient.cancelEventRsvp);
  } catch (error) {
    console.error('❌ Error creating auth client:', error);
  }
} else {
  console.error('❌ AuthClient class not found - auth-client.js may not have loaded');
}
</script>
